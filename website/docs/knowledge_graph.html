<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lessVM Knowledge Graph</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .legend {
            margin: 20px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border: 1px solid #333;
        }
        .core { background: #f9f; }
        .security { background: #ff9; }
        .external { background: #9f9; }
        .testing { background: #99f; }
        .instruction { background: #f99; }
    </style>
</head>
<body>
    <div class="container">
        <h1>lessVM Knowledge Graph</h1>
        
        <div class="legend">
            <h3>Component Types</h3>
            <div class="legend-item">
                <div class="legend-color core"></div>
                <span>Core Components - Central VM functionality</span>
            </div>
            <div class="legend-item">
                <div class="legend-color security"></div>
                <span>Security & Monitoring - Safety and resource tracking</span>
            </div>
            <div class="legend-item">
                <div class="legend-color external"></div>
                <span>External Integration - Solana blockchain interface</span>
            </div>
            <div class="legend-item">
                <div class="legend-color testing"></div>
                <span>Testing & Development - Validation and debugging</span>
            </div>
            <div class="legend-item">
                <div class="legend-color instruction"></div>
                <span>Instructions - Operation categories</span>
            </div>
        </div>

        <div class="mermaid">
graph TB
    %% Core Components
    VM_Core[VM Core]
    Stack[Stack]
    Memory[Memory]
    GasMetering[Gas Metering]
    SecurityChecker[Security Checker]
    AccountOps[Account Operations]
    ErrorHandler[Error Handler]
    InstructionSet[Instruction Set]
    Debugger[Debugger]
    SolanaRuntime[Solana Runtime]
    
    %% Testing & Deployment
    TestFramework[Test Framework]
    DeploymentSystem[Deployment System]

    %% Core Dependencies
    VM_Core --> |manages| Stack
    VM_Core --> |manages| Memory
    VM_Core --> |uses| InstructionSet
    VM_Core --> |monitored by| GasMetering
    VM_Core --> |validated by| SecurityChecker

    %% Security & Monitoring
    SecurityChecker --> |validates| Stack
    SecurityChecker --> |validates| Memory
    SecurityChecker --> |validates| AccountOps
    GasMetering --> |monitors| Stack
    GasMetering --> |monitors| Memory
    GasMetering --> |monitors| VM_Core

    %% Error Handling
    ErrorHandler --> |handles errors| VM_Core
    ErrorHandler --> |handles errors| Stack
    ErrorHandler --> |handles errors| Memory
    ErrorHandler --> |handles errors| AccountOps
    ErrorHandler --> |reports to| SolanaRuntime

    %% Solana Integration
    AccountOps --> |interfaces with| SolanaRuntime
    DeploymentSystem --> |deploys to| SolanaRuntime

    %% Debugging & Testing
    Debugger --> |monitors| VM_Core
    Debugger --> |monitors| Stack
    Debugger --> |monitors| Memory
    TestFramework --> |tests| VM_Core
    TestFramework --> |tests| Stack
    TestFramework --> |tests| Memory
    TestFramework --> |tests| AccountOps

    %% Instruction Categories
    subgraph Instructions
        StackOps[Stack Operations]
        MathOps[Math Operations]
        MemoryOps[Memory Operations]
        ControlFlow[Control Flow]
        SolanaOps[Solana Operations]
    end

    InstructionSet --> StackOps
    InstructionSet --> MathOps
    InstructionSet --> MemoryOps
    InstructionSet --> ControlFlow
    InstructionSet --> SolanaOps

    %% Component Types
    classDef core fill:#f9f,stroke:#333,stroke-width:2px
    classDef security fill:#ff9,stroke:#333,stroke-width:2px
    classDef external fill:#9f9,stroke:#333,stroke-width:2px
    classDef testing fill:#99f,stroke:#333,stroke-width:2px
    classDef instruction fill:#f99,stroke:#333,stroke-width:2px

    class VM_Core,Stack,Memory core
    class SecurityChecker,GasMetering security
    class SolanaRuntime external
    class TestFramework,Debugger testing
    class StackOps,MathOps,MemoryOps,ControlFlow,SolanaOps instruction
        </div>

        <h2>Component Relationships</h2>
        <p>The knowledge graph visualizes the key components and relationships in the lessVM system:</p>

        <h3>1. Core Components</h3>
        <ul>
            <li>VM Core acts as the central execution engine</li>
            <li>Stack provides LIFO data structure with 32 entries</li>
            <li>Memory manages a fixed 1024-byte array</li>
            <li>Instruction Set defines all available operations</li>
        </ul>

        <h3>2. Security & Monitoring</h3>
        <ul>
            <li>Security Checker validates all operations</li>
            <li>Gas Metering tracks and limits resource usage</li>
            <li>Error Handler manages system-wide error states</li>
        </ul>

        <h3>3. External Integration</h3>
        <ul>
            <li>Account Operations manages Solana account interactions</li>
            <li>Solana Runtime provides blockchain interface</li>
            <li>Deployment System handles program lifecycle</li>
        </ul>

        <h3>4. Testing & Development</h3>
        <ul>
            <li>Test Framework validates all components</li>
            <li>Debugger provides execution tracing</li>
            <li>Example programs demonstrate functionality</li>
        </ul>

        <h3>5. Instructions</h3>
        <ul>
            <li>Stack Operations: Push, Pop, Dup, Swap</li>
            <li>Math Operations: Add, Mul, Div, MulDiv</li>
            <li>Memory Operations: Load, Store, LoadN, StoreN</li>
            <li>Control Flow: Jump, JumpI, Call, Return</li>
            <li>Solana Operations: Transfer, SPLTransfer, Log</li>
        </ul>

        <script>
            mermaid.initialize({ 
                startOnLoad: true,
                theme: 'default',
                securityLevel: 'loose'
            });
        </script>
    </div>
</body>
</html>
